# Don't let the name fool you, we're building LADSPA, not LV2
INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/include"
	"${CMAKE_CURRENT_SOURCE_DIR}"
	"${CMAKE_CURRENT_SOURCE_DIR}/caps-lv2")
FILE(GLOB SOURCES caps-lv2/*.cc)
LIST(APPEND SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/caps-lv2/dsp/polynomials.cc")
LIST(SORT SOURCES)
ADD_LIBRARY(caps MODULE ${SOURCES})
INSTALL(TARGETS caps LIBRARY DESTINATION "${PLUGIN_DIR}/ladspa")
IF(LMMS_BUILD_WIN64)
ADD_DEFINITIONS(-DLMMS_BUILD_WIN64)
ENDIF(LMMS_BUILD_WIN64)
SET_TARGET_PROPERTIES(caps PROPERTIES PREFIX "")

if(MSVC)
	target_compile_options(caps PRIVATE /wd4244 /wd4305)
else()
	target_compile_options(caps PRIVATE -O2 -funroll-loops -Wno-write-strings)
endif()

if(MSVC)
	target_link_options(caps PRIVATE "/EXPORT:ladspa_descriptor")
endif()

IF(LMMS_BUILD_WIN32)
	add_custom_command(
		TARGET caps
		POST_BUILD
		COMMAND "${STRIP_COMMAND}" "$<TARGET_FILE:caps>"
		VERBATIM
		COMMAND_EXPAND_LISTS
	)
ENDIF(LMMS_BUILD_WIN32)

IF(NOT LMMS_BUILD_APPLE AND NOT LMMS_BUILD_OPENBSD)
	SET_TARGET_PROPERTIES(caps PROPERTIES LINK_FLAGS "${LINK_FLAGS} -shared -Wl,-no-undefined")
ENDIF(NOT LMMS_BUILD_APPLE AND NOT LMMS_BUILD_OPENBSD)

IF(LMMS_BUILD_LINUX)
	SET_TARGET_PROPERTIES(caps PROPERTIES LINK_FLAGS "${LINK_FLAGS}")
ENDIF(LMMS_BUILD_LINUX)

