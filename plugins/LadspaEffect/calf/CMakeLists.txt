FILE(GLOB SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp")
LIST(SORT SOURCES)
ADD_LIBRARY(calf MODULE ${SOURCES})
INCLUDE_DIRECTORIES("${CMAKE_SOURCE_DIR}/include"
                    "${CMAKE_BINARY_DIR}"
                    "${CMAKE_CURRENT_SOURCE_DIR}"
                    "${CMAKE_CURRENT_SOURCE_DIR}/src")
INSTALL(TARGETS calf LIBRARY DESTINATION "${PLUGIN_DIR}/ladspa")
SET_TARGET_PROPERTIES(calf PROPERTIES PREFIX "")

SET(INLINE_FLAGS "")

INCLUDE(CheckCXXCompilerFlag)
CHECK_CXX_COMPILER_FLAG(-finline-functions CXX_HAVE_INLINE_FUNCTIONS)
IF(${CXX_HAVE_INLINE_FUNCTIONS})
	SET(INLINE_FLAGS "${INLINE_FLAGS} -finline-functions")
ENDIF()
CHECK_CXX_COMPILER_FLAG(-finline-functions-called-once
	CXX_HAVE_INLINE_FUNCTIONS_CALLED_ONCE)
IF(${CXX_HAVE_INLINE_FUNCTIONS_CALLED_ONCE})
	SET(INLINE_FLAGS "${INLINE_FLAGS} -finline-functions-called-once \
		-finline-limit=80")
ENDIF()

SET_TARGET_PROPERTIES(calf PROPERTIES COMPILE_FLAGS "-O2 ${INLINE_FLAGS}")

IF(LMMS_BUILD_WIN32)
	ADD_CUSTOM_COMMAND(TARGET calf POST_BUILD COMMAND "${STRIP}" "$<TARGET_FILE:calf>")
ENDIF(LMMS_BUILD_WIN32)
IF(NOT LMMS_BUILD_APPLE AND NOT LMMS_BUILD_OPENBSD)
	SET_TARGET_PROPERTIES(calf PROPERTIES LINK_FLAGS "${LINK_FLAGS} -shared -Wl,-no-undefined")
ENDIF(NOT LMMS_BUILD_APPLE AND NOT LMMS_BUILD_OPENBSD)

