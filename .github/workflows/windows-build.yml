name: Windows Build LMMS

# Run on every push to your fork or manually
on:
  push:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      # 1️⃣ Checkout your fork
      - name: Checkout source
        uses: actions/checkout@v4
        with:
          submodules: recursive  # ensures LMMS submodules are cloned

      # 2️⃣ Install dependencies
      - name: Install dependencies
        run: |
          choco install -y cmake ninja python git
          choco install -y qt5-default  # LMMS requires Qt5
          install: >-
            mingw-w64-x86_64-libsndfile
            mingw-w64-x86_64-pkg-config
            mingw-w64-x86_64-qt5-base
            mingw-w64-x86_64-fftw
            mingw-w64-x86_64-ninja
          refreshenv  # refresh environment variables so Qt5 is detected

      # 3️⃣ Configure the build with CMake
      - name: Configure build
        run: |
          cmake -S . -B build -G Ninja -DCMAKE_BUILD_TYPE=Release

      # 4️⃣ Build LMMS
      - name: Build LMMS
        run: |
          cmake --build build --config Release

      # 5️⃣ Upload the build artifacts for download
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: lmms-windows-build
          path: build
