name: build
on: [push, pull_request]
jobs:
  mingw64:
    name: mingw64
    runs-on: ubuntu-18.04
    container: lmmsci/linux.mingw64:18.04
    steps:
    - name: Update and configure Git
      run: |
        add-apt-repository ppa:git-core/ppa
        apt-get update
        apt-get --yes install git
        git config --global --add safe.directory /__w/lmms/lmms
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        submodules: recursive
    - name: Build
      run: |
        mkdir build && cd build
        ../cmake/build_win64.sh
        make -j2
    - name: Build tests
      run: cd build && make -j2 tests
    - name: Package
      run: cd build && make -j2 package
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: mingw64
        path: build/lmms-*.exe
