#!/bin/bash

# Halt on first error
set -e

DESTDIR="/opt/@CPACK_PROJECT_NAME@"
if [ "$(id -u)" != "0" ]; then
	# Prepend "$HOME" so we can install to a writable location
	DESTDIR="${HOME}${DESTDIR}"
	echo "Installing as a regular user to $DESTDIR..."
else
	echo "Installing as elevated user to $DESTDIR..."
fi

# Deploy @CPACK_PROJECT_NAME_UCASE@
mkdir -p "${DESTDIR}"
unalias cp &> /dev/null || true
cp -rf ./* "${DESTDIR}"
rm -f "${DESTDIR}/setup.sh"
mv "${DESTDIR}/AppRun" "${DESTDIR}/lmms"

# Test LMMS
echo "Installation complete... Testing \"$LMMS\"..."
"${DESTDIR}/lmms" --allowroot --version &> /dev/null

# TODO: Register file associations, desktop icon, etc

echo "@CPACK_PROJECT_NAME_UCASE@ was installed successfully to ${DESTDIR}.  To run:"
echo "  ${DESTDIR}/lmms"