# Use @VAR@ for immediate expansion (e.g. @CMAKE_SOURCE_DIR@)
# Use ${VAR} for delayed expansion (e.g. ${CMAKE_INSTALL_PREFIX})

# Install resource files
file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/Info.plist" DESTINATION "${CPACK_TEMPORARY_INSTALL_DIRECTORY}")
file(INSTALL "@CMAKE_CURRENT_SOURCE_DIR@/icon.icns" DESTINATION "${CPACK_TEMPORARY_INSTALL_DIRECTORY}/Resources")
file(INSTALL "@CMAKE_CURRENT_SOURCE_DIR@/project.icns" DESTINATION "${CPACK_TEMPORARY_INSTALL_DIRECTORY}/Resources")

# tiff file is multi-resource (1x & 2x) created programatically using convert
execute_process(COMMAND convert "@CMAKE_CURRENT_SOURCE_DIR@/*.png" "@CMAKE_CURRENT_BINARY_DIR@/background.tiff")

# Updates appdmg.json with CPACK_TEMPORARY_INSTALL_DIRECTORY
# - .DS_Store can be recreated using appdmg appdmg.json lmms.dmg
# - Find new .DS_Store from the root of the DMG file
# - cp /Volumes/lmms-x.x.x/.DS_Store ../cmake/apple/DS_Store
configure_file("@CMAKE_CURRENT_BINARY_DIR@/_appdmg.json.in" "@CMAKE_CURRENT_BINARY_DIR@/appdmg.json")
file(REMOVE "@CMAKE_CURRENT_BINARY_DIR@/_appdmg.json.in")

# TODO: Port this script to CMake
execute_process(COMMAND chmod u+x @CMAKE_CURRENT_BINARY_DIR@/package_apple.sh)
execute_process(COMMAND @CMAKE_CURRENT_BINARY_DIR@/package_apple.sh ${CPACK_TEMPORARY_INSTALL_DIRECTORY} RESULT_VARIABLE EXIT_CODE)
if(NOT EXIT_CODE EQUAL 0)
	message(FATAL_ERROR "Execution of package_apple.sh failed")
endif()